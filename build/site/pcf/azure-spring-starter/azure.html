                <!DOCTYPE html>
<html lang="en">
<head>

<meta name="course version" content="1.1.0">
<meta name="generator" content="io.pivotal.pal.shipkin:shipkin-plugin:5.1.0, https://github.com/platform-acceleration-lab/shipkin">
<meta name="generated on" content="2018-04-10T21:46:01.075Z">
<meta name="theme-color" content="#00ae9e">


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Pivotal Azure Workshop</title>

<link rel="icon" href="../../images/favicon.ico">

<link rel="stylesheet" href="../../css/reset.css">
<link rel="stylesheet" href="../../css/theme.css">
<link rel="stylesheet" href="../../css/highlight.js.min.css">
<link rel="stylesheet" href="../../css/github.css">

<style>

    #header {
        border-color: #86c775;
        background-color: #00ae9e;
    }

    footer {
        background-color: #00ae9e;
    }

    .label.label-primary {
        background-color: #009fdf;
    }

    a {
        color: #009fdf;
    }

    .label.label-primary:hover, .label.label-primary:focus {
        background-color: #faeee;
    }

    a:hover, a:focus {
        color: #faeee;
    }

    .slide {
        color: #00ae9e;
    }

    .slide h2, .slide label {
        color: #009fdf;
    }

    .slide input {
        color: rgba(0, 174, 158, 0.65);
    }

    .face path {
        fill: #009fdf;
    }

    body {
        background-color: #fffff0;
    }

    .slide {
        background-color: rgba(255, 255, 240, 0.9);
    }

    .slide.text {
        background-color: #fffff0;
    }

    .slide h2, .slide label {
        color: inherit;
    }



    .slide:before {
        background-image: url(../../images/sheep.png);
        background-size: contain;
        background-repeat: no-repeat;
        content: "";

        height: 120px;
        width: 115px;
        position: fixed;
        top: 20px;
        left: 20px;
    }
</style>

</head>
<body>


<style>
    #header {
        background: linear-gradient(rgba(0, 174, 158, 0.65), rgba(0, 174, 158, 0.65)), url(../../images/cloud-security.jpg) no-repeat center;
        background-size: cover;

    }
</style>

<header id="header">
    <div class="container">
        <img src="../../images/scs-logo.png" alt="Pivotal Azure Workshop logo">

        <div>
            <a href="../..">
                <h1>Pivotal Azure Workshop</h1>

            </a>

        </div>
    </div>
</header>


<a class="feedback" href="https://docs.google.com/forms/d/e/1FAIpQLSdR2-woVmejvILly2I_BYuXQyAY_xAo5ygvTnjJGHsjx7lfHw/viewform" data-url-field="entry.1985209097" target="_blank" rel="noreferrer noopener">
    <button>feedback</button>
</a>

<main id="main">

    <div id="content" class="container">
        <article>
 <h1 id="overview">Overview</h1>
<p>Filler text.</p>
<h1 id="azure-service-broker">Azure Service Broker</h1>
<p>Here we will prepare Azure with the base services we need for a Spring Starter App.</p>
<h2 id="prepare-azure-blob-storage">Prepare Azure Blob Storage.</h2>
<ol>
<li>
<p>Create a JSON file called <code>azure-storage.json</code>:</p>
<pre><code class="language-json">{
&quot;resource_group_name&quot;: &quot;my-resource-group&quot;,
&quot;storage_account_name&quot;: &quot;mystorageaccountname&quot;,
&quot;location&quot;: &quot;westus&quot;,
&quot;account_type&quot;: &quot;Standard_LRS&quot;
}
</code></pre>
</li>
<li>
<p>Create an Azure Storage service instance by running the following command:</p>
<p><code>cf create-service azure-storage standard a-storage -c ./azure-storage.json</code></p>
<p>Look into your Azure portal and check the resource group and the storage account created</p>
</li>
</ol>
<h1 id="spring">Spring</h1>
<p>Filler text.</p>
<h2 id="create-the-spring-starter-app">Create the Spring Starter App</h2>
<p>Here we will create the Spring Starter App for Azure.</p>
<ol>
<li>
<p>Go to start.spring.io and bootstrap a project with the following dependencies:</p>
<ul>
<li>Web</li>
<li>Azure Support</li>
<li>Azure Storage</li>
</ul>
</li>
<li>
<p>Fill out the Project Metadata with these values:</p>
</li>
</ol>
<table class="table">
<thead>
<tr><th>Group</th><th>Artifact</th></tr>
</thead>
<tbody>
<tr><td><code>io.pivotal</code></td><td><code>azure-storage-client</code></td></tr>
</tbody>
</table>
<ol>
<li>
<p>Click the <em>Generate Project</em> button and your browser will download the <code>azure-storage-client.zip</code> file.</p>
</li>
<li>
<p>Unzip the project to <code>CN-Workshop/labs/azure</code>.</p>
</li>
<li>
<p>From your IDE, import this project as an existing Maven project.</p>
</li>
<li>
<p>Now we need to create the application. Open this Java class in your project in your IDE. This is a skeleton application class auto-generated by Spring Initializr for you. <code>src/main/java/io/pivotal/azurestorageclient/AzureStorageClientApplication.java</code></p>
</li>
<li>
<p>Add the @RestController annotation to the Class definition and the method <em>upload</em> to this class from the code snippet below. After you add this code, your class should look exactly like this snippet below.</p>
<pre><code class="language-java">package io.pivotal.azurestorageclient;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.multipart.MultipartFile;

import com.microsoft.azure.storage.CloudStorageAccount;
import com.microsoft.azure.storage.blob.CloudBlobClient;
import com.microsoft.azure.storage.blob.CloudBlobContainer;
import com.microsoft.azure.storage.blob.CloudBlockBlob;

@SpringBootApplication
@RestController
public class AzureStorageClientApplication {

    // for blob storage
    @Autowired
    private CloudStorageAccount cloudStorageAccount;

    @RequestMapping(&quot;/uploadfile&quot;)
    public boolean upload(@RequestParam(&quot;file&quot;) MultipartFile file,
                        @RequestParam(&quot;azureContainerName&quot;) String azureContainerName) {

        try {
            // Convert File to Byte Array
            final String fileName = file.getOriginalFilename();
            byte[] fileBytes = file.getBytes();

            // Upload File to Azure Storage Container
            CloudBlobClient client = cloudStorageAccount
                    .createCloudBlobClient();
            CloudBlobContainer container = client
                    .getContainerReference(azureContainerName);
            container.createIfNotExists();

            CloudBlockBlob blob = container.getBlockBlobReference(fileName);
            blob.upload(file.getInputStream(), fileBytes.length);

        } catch (Exception e) {
            e.printStackTrace();
        }
        return true;
    }

    public static void main(String[] args) {
        SpringApplication.run(AzureDemoApplication.class, args);
    }
}
</code></pre>
</li>
<li>
<p>Compile the demo application with Maven:</p>
<pre><code class="language-sh">./mvnw clean install
</code></pre>
</li>
</ol>
<h2 id="deploy-to-cloud-foundry">Deploy to Cloud Foundry</h2>
<ol>
<li>
<p>In order to deploy the starter app to Cloud Foundry efficiently, we'll need to create a manifest. Create <code>CN-Workshop/labs/azure/manifest/yml</code> and populate it with these values.</p>
<pre><code class="language-yaml">---
applications:
- name: azure-demo-app
memory: 1G
instances: 1
path: target/MY-APP-JAR.jar
</code></pre>
</li>
<li>
<p>Now the application is ready to be pushed to Cloud Foundry.</p>
<pre><code class="language-sh">cf push --no-start
</code></pre>
</li>
<li>
<p>Now we have to bind the app to the Service Instance previously created.</p>
<pre><code class="language-sh">cf bind-service azure-demo-app a-storage
</code></pre>
</li>
<li>
<p>Now we need to start our application.</p>
<pre><code class="language-sh">cf start azure-demo-app
</code></pre>
</li>
</ol>
<h2 id="test-our-app">Test Our App</h2>
         </article>
        <div class="sidebar-container">
<nav id="sidebar">
    <div class="title">
        <a href="../../index.html">Return to Pivotal Azure Workshop</a>
    </div>
    <div class="content">
        <a href="#">Back to top</a>

<ul>
        <li>
        <a href="#overview">Overview</a>

        </li>
        <li>
        <a href="#azure-service-broker">Azure Service Broker</a>

<ul>
        <li>
        <a href="#prepare-azure-blob-storage">Prepare Azure Blob Storage.</a>

        </li>
</ul>
        </li>
        <li>
        <a href="#spring">Spring</a>

<ul>
        <li>
        <a href="#create-the-spring-starter-app">Create the Spring Starter App</a>

        </li>
        <li>
        <a href="#deploy-to-cloud-foundry">Deploy to Cloud Foundry</a>

        </li>
        <li>
        <a href="#test-our-app">Test Our App</a>

        </li>
</ul>
        </li>
</ul>
    </div>
</nav>
        </div>
    </div>
</main>


<div class="slide" data-slide="1">
    <h1>Pivotal Azure Workshop</h1>
</div>

<div class="slide transparent" data-slide="2">
    <h1>Get started!</h1>
</div>

<div class="slide" data-slide="3">
    <h1>Wrap up</h1>

    <div class="faces">
        <svg class="face" viewBox="0 0 24 24">
            <path d="M12,2C6.47,2 2,6.47 2,12C2,17.53 6.47,22 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M13,9.94L14.06,11L15.12,9.94L16.18,11L17.24,9.94L15.12,7.82L13,9.94M8.88,9.94L9.94,11L11,9.94L8.88,7.82L6.76,9.94L7.82,11L8.88,9.94M12,17.5C14.33,17.5 16.31,16.04 17.11,14H6.89C7.69,16.04 9.67,17.5 12,17.5Z"/>
        </svg>

        <svg class="face" viewBox="0 0 24 24">
            <path d="M8.5,11A1.5,1.5 0 0,1 7,9.5A1.5,1.5 0 0,1 8.5,8A1.5,1.5 0 0,1 10,9.5A1.5,1.5 0 0,1 8.5,11M15.5,11A1.5,1.5 0 0,1 14,9.5A1.5,1.5 0 0,1 15.5,8A1.5,1.5 0 0,1 17,9.5A1.5,1.5 0 0,1 15.5,11M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M9,14H15A1,1 0 0,1 16,15A1,1 0 0,1 15,16H9A1,1 0 0,1 8,15A1,1 0 0,1 9,14Z"/>
        </svg>

        <svg class="face" viewBox="0 0 24 24">
            <path d="M12,2C6.47,2 2,6.47 2,12C2,17.53 6.47,22 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M16.18,7.76L15.12,8.82L14.06,7.76L13,8.82L14.06,9.88L13,10.94L14.06,12L15.12,10.94L16.18,12L17.24,10.94L16.18,9.88L17.24,8.82L16.18,7.76M7.82,12L8.88,10.94L9.94,12L11,10.94L9.94,9.88L11,8.82L9.94,7.76L8.88,8.82L7.82,7.76L6.76,8.82L7.82,9.88L6.76,10.94L7.82,12M12,14C9.67,14 7.69,15.46 6.89,17.5H17.11C16.31,15.46 14.33,14 12,14Z"/>
        </svg>
    </div>
</div>


<div class="slide lemon-squeezy" data-slide="7">
    <h1>Easy peasy</h1>
    <h1>lemon squeezy!</h1>
</div>

<div class="slide" data-slide="8">
    <h1>Lunch time!</h1>
    <label for="lunch-end">will return</label>
    <input type="text" name="lunch-end" data-time>
</div>

<div class="slide" data-slide="9">
    <h1>Break time!</h1>
    <label for="break-end">will return</label>
    <input type="text" name="break-end" data-time>
</div>

<audio src="../../audio/gong.mp3"
       id="gong"
       preload>
</audio>

<div class="slide" data-slide="¿">
    <h2>Keyboard shortcuts</h2>
    <table>
        <thead>
        <tr>
            <th>Key</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>1</td>
            <td>Show <em>introduction</em> slide</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Show <em>get started</em> slide</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Show <em>wrap up</em> slide</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Show <em>instructor notes</em></td>
        </tr>
        <tr>
            <td>7</td>
            <td>Easy peasy</td>
        </tr>
        <tr>
            <td>8</td>
            <td>Show <em>lunch time</em> slide</td>
        </tr>
        <tr>
            <td>9</td>
            <td>Show <em>break time</em> slide</td>
        </tr>
        <tr>
            <td>0</td>
            <td>Play gong sound</td>
        </tr>
        <tr>
            <td>ESC</td>
            <td>Close slide</td>
        </tr>
        <tr>
            <td>?</td>
            <td>Show this help message</td>
        </tr>
        </tbody>
    </table>
</div>

<footer>
    <a href="https://pivotal.io/legal" rel="noreferrer noopener">CONFIDENTIAL -
        © Copyright 2018 Pivotal Software, Inc. All Rights Reserved.</a>
    <div>
        <label class="hidden-checkbox">
            <input type="checkbox" id="instructor-mode">
            <span>course version: 1.1.0<sup class="check">IM</sup></span>
        </label>
    </div>
</footer>

<script src="../../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="../../js/shipkin.js"></script>
<script src="../../js/slides.js"></script>

</body>
</html>

